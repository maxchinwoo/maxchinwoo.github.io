<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë§ì…ˆ ì—°ìŠµ ê²Œì„</title>
<style>
  body { margin:0; background:#000; color:#fff; font-family:sans-serif; text-align:center; }
  canvas { background:#111; display:block; margin:10px auto; border:2px solid #1e90ff; border-radius:8px; }
  .controls { display:flex; justify-content:center; flex-wrap:wrap; gap:8px; margin-top:10px; }
  button {
    width:60px; height:60px; font-size:24px;
    border:none; border-radius:8px; background:#1e90ff; color:#fff; cursor:pointer;
  }
  #resetBtn, #homeBtn {
    width:auto; padding:8px 16px; font-size:18px; margin:10px;
  }
  #hud { margin:10px; font-size:18px; }
</style>
</head>
<body>
<h2>ğŸ§® ë§ì…ˆ ì—°ìŠµ ê²Œì„</h2>
<canvas id="game" width="400" height="500"></canvas>
<div id="hud">LEVEL: 1 | TIME: 60</div>
<div class="controls" id="numPad"></div>
<button id="enterBtn">ì…ë ¥</button>
<div>
  <button id="resetBtn">ğŸ”„ ë¦¬ì…‹</button>
  <button id="homeBtn">ğŸ  í™ˆ</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const hud=document.getElementById("hud");

let problems=[];
let level=1, timeLeft=40, score=0;
let currentInput="";
let isRunning=false, timerId=null;
let fallSpeed=1.2; // ê¸°ë³¸ ì†ë„

// ë¬¸ì œ ìƒì„± (ë‘ìë¦¬ìˆ˜ + í•œìë¦¬ìˆ˜)
function makeProblem(){
  const a=Math.floor(Math.random()*90)+10; // 10~99
  const b=Math.floor(Math.random()*9)+1;   // 1~9
  return {text:`${a}+${b}`, ans:a+b, x:Math.random()*300+20, y:0};
}

// ë ˆë²¨ë³„ ì†ë„ ì„¤ì •
function setLevelSpeed(){
  if(level===1) fallSpeed=1.2*0.2; // 70%
  else if(level===2) fallSpeed=1.2*0.3; // 60%
  else if(level===3) fallSpeed=1.2*0.4; // 50%
}

// ê²Œì„ ë¦¬ì…‹
function resetGame(){
  level=1; timeLeft=40; score=0;
  problems=[]; currentInput="";
  setLevelSpeed();
  isRunning=true;
  clearInterval(timerId);
  timerId=setInterval(tick,1000);
  requestAnimationFrame(loop);
}
document.getElementById("resetBtn").onclick=resetGame;
document.getElementById("homeBtn").onclick=()=>location.reload();

// íƒ€ì´ë¨¸
function tick(){
  if(!isRunning) return;
  timeLeft--;
  if(timeLeft<=0){
    level++;
    if(level>3){
      alert("ğŸ‰ ëª¨ë“  ë ˆë²¨ í´ë¦¬ì–´! ìŠ¹ë¦¬!");
      isRunning=false; clearInterval(timerId);
      return;
    }
    timeLeft=40;
    setLevelSpeed();
    alert(`ë ˆë²¨ ${level} ì‹œì‘!`);
  }
}

// ë©”ì¸ ë£¨í”„
function loop(){
  if(!isRunning) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ë¬¸ì œ ìƒì„±
  if(Math.random()<0.005*level) problems.push(makeProblem());

  // ë¬¸ì œ ì´ë™
  problems.forEach(p=>p.y+=fallSpeed);

  // === ì‹¤íŒ¨ ì¡°ê±´ ì²´í¬ ===
  for(let p of problems){
    if(p.y>=canvas.height-10){ 
      alert("ğŸ’€ ë¬¸ì œë¥¼ ë†“ì³¤ìŠµë‹ˆë‹¤! ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.");
      resetGame();
      return;
    }
  }

  // ë¬¸ì œ ê·¸ë¦¬ê¸°
  ctx.fillStyle="#fff";
  ctx.font="20px Arial";
  problems.forEach(p=>{
    ctx.fillText(p.text,p.x,p.y);
  });

  // í˜„ì¬ ì…ë ¥ í‘œì‹œ
  ctx.fillStyle="#0f0";
  ctx.fillText("ì…ë ¥: "+currentInput,10,480);

  hud.textContent=`LEVEL: ${level} | TIME: ${timeLeft}s | SCORE: ${score}`;
  requestAnimationFrame(loop);
}

// ì…ë ¥ ì²´í¬
document.getElementById("enterBtn").onclick=()=>{
  if(currentInput==="") return;
  let num=parseInt(currentInput);
  for(let i=0;i<problems.length;i++){
    if(problems[i].ans===num){
      problems.splice(i,1);
      score++;
      break;
    }
  }
  currentInput="";
};

// ë²ˆí˜¸í‚¤ UI ìƒì„±
const pad=document.getElementById("numPad");
for(let i=0;i<=9;i++){
  const btn=document.createElement("button");
  btn.textContent=i;
  btn.onclick=()=>{ currentInput+=i; };
  pad.appendChild(btn);
}

// ì‹œì‘
resetGame();
</script>
</body>
</html>
