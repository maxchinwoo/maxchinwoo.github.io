<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ëœë¤ ì„±ê²½êµ¬ì ˆ (í•œ/ì˜ ë™ì¼)</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#101620; --card:#0f1520; --pri:#49a2ff; --txt:#e8f1ff; --sub:#a7bed3;
    --ok:#3bd16f; --warn:#ffb74e; --err:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--txt);
    font-family:system-ui,Segoe UI,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif}
  a{color:var(--pri);text-decoration:none}
  .wrap{max-width:880px;margin:0 auto;padding:14px}
  .topbar{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:10px}
  .brand{font-weight:800;font-size:18px}
  .small{color:var(--sub);font-size:12px}
  .panel{background:var(--panel);border:1px solid #1e2733;border-radius:14px;padding:12px;margin-bottom:12px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:760px){.row{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid #1a2330;border-radius:16px;padding:14px}
  .lang{font-size:12px;color:var(--sub);margin-bottom:4px}
  .ref{font-size:14px;color:var(--sub);margin-bottom:8px}
  .text{font-size:22px;line-height:1.65;white-space:pre-wrap}
  .btns{display:flex;gap:8px;flex-wrap:wrap}
  button{
    cursor:pointer;border:none;border-radius:14px;background:var(--pri);color:#fff;
    padding:14px 18px;font-weight:800;font-size:18px;width:100%
  }
  button.ghost{background:#182232;color:var(--txt);border:1px solid #243247}
  .status{font-size:12px;margin-top:8px}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  .footer{margin-top:14px;font-size:12px;color:var(--sub)}
  .tags{display:flex;gap:6px;flex-wrap:wrap}
  .tag{display:inline-flex;align-items:center;gap:6px;background:#122136;border:1px solid #25324b;border-radius:999px;padding:6px 10px;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">ğŸ“– ëœë¤ ì„±ê²½êµ¬ì ˆ (í•œ/ì˜ ë™ì¼)</div>
    <div class="tags">
      <a class="tag" href="./index.html">í™ˆ</a>
      <a class="tag" href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a>
    </div>
  </div>

  <div class="panel">
    <div class="small" style="margin-bottom:10px">
      â€¢ í•œêµ­ì–´ëŠ” <b>ë¡œì»¬ JSON</b>(ì˜ˆ: <code>korrrv.json</code>)ì—ì„œ êµ¬ì ˆì„ ë¬´ì‘ìœ„ë¡œ ì„ íƒí•©ë‹ˆë‹¤.<br/>
      â€¢ ì˜ì–´ëŠ” ë™ì¼í•œ êµ¬ì ˆì„ <b>WEB</b>(World English Bible, bible-api.com)ë¡œ ê°€ì ¸ì™€ ë‚˜ë€íˆ ë³´ì—¬ì¤ë‹ˆë‹¤.<br/>
      â€¢ ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ë³´ê¸° ì‰½ë„ë¡ í° ê¸€ì”¨ì™€ ë‹¨ì¼ ë²„íŠ¼ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
    </div>
    <div class="btns">
      <button id="btnRandom">ğŸ² ì˜¤ëŠ˜ì˜ ëœë¤ êµ¬ì ˆ (í•œ/ì˜ ë™ì¼)</button>
      <button class="ghost" id="btnCopy">ğŸ“‹ ë³µì‚¬</button>
    </div>
    <div class="status" id="status"></div>
  </div>

  <div class="row">
    <div class="card">
      <div class="lang">í•œêµ­ì–´ (ë¡œì»¬)</div>
      <div class="ref" id="koRef">-</div>
      <div class="text" id="koText">ë²„íŠ¼ì„ ëˆŒëŸ¬ ëœë¤ êµ¬ì ˆì„ í‘œì‹œí•˜ì„¸ìš”.</div>
    </div>
    <div class="card">
      <div class="lang">English (WEB)</div>
      <div class="ref" id="enRef">-</div>
      <div class="text" id="enText">Press the button to show a matched verse.</div>
    </div>
  </div>

  <div class="footer">
    <div class="small">
      * ë¡œì»¬ íŒŒì¼ëª…ì€ ê¸°ë³¸ <code>korrrv.json</code> ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë¦„ì„ ì“°ë©´ ìŠ¤í¬ë¦½íŠ¸ ìƒë‹¨ <code>KOR_JSON_PATH</code>ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.<br/>
      * WEBì€ í¼ë¸”ë¦­ ë„ë©”ì¸ ë²ˆì—­ì´ë©°, bible-api.comì„ í†µí•´ êµ¬ì²´ ì ˆë¡œ ìš”ì²­í•©ë‹ˆë‹¤.
    </div>
  </div>
</div>

<script>
/* ===== ì„¤ì • ===== */
const KOR_JSON_PATH = './korrrv.json'; // ë¡œì»¬ í•œêµ­ì–´ ë°ì´í„° ê²½ë¡œ(í•„ìš”í•˜ë©´ './korrrv1.json'ìœ¼ë¡œ ë³€ê²½)
const BIBLE_API_BASE = 'https://bible-api.com'; // ì˜ì–´ WEB(ë¬´ë£Œ 1ì¢…)ë§Œ ì‚¬ìš©

/* ===== ìš”ì†Œ ===== */
const els = {
  btnRandom: document.getElementById('btnRandom'),
  btnCopy: document.getElementById('btnCopy'),
  status: document.getElementById('status'),
  koRef: document.getElementById('koRef'),
  koText: document.getElementById('koText'),
  enRef: document.getElementById('enRef'),
  enText: document.getElementById('enText'),
};

/* ===== í•œêµ­ì–´ ì±…ëª… â†’ ì˜ì–´ ì±…ëª… ë§¤í•‘ (bible-api.comìš©) =====
   ì¼ë¶€ëŠ” ì—¬ëŸ¬ í‘œê¸°ë¥¼ ì‹œë„(ì•„ê°€: Song of Songs/Solomon ë“±)  */
const BOOK_MAP = {
  'ì°½ì„¸ê¸°':'Genesis','ì¶œì• êµ½ê¸°':'Exodus','ë ˆìœ„ê¸°':'Leviticus','ë¯¼ìˆ˜ê¸°':'Numbers','ì‹ ëª…ê¸°':'Deuteronomy',
  'ì—¬í˜¸ìˆ˜ì•„':'Joshua','ì‚¬ì‚¬ê¸°':'Judges','ë£»ê¸°':'Ruth',
  'ì‚¬ë¬´ì—˜ìƒ':'1 Samuel','ì‚¬ë¬´ì—˜í•˜':'2 Samuel','ì—´ì™•ê¸°ìƒ':'1 Kings','ì—´ì™•ê¸°í•˜':'2 Kings',
  'ì—­ëŒ€ìƒ':'1 Chronicles','ì—­ëŒ€í•˜':'2 Chronicles','ì—ìŠ¤ë¼':'Ezra','ëŠí—¤ë¯¸ì•¼':'Nehemiah','ì—ìŠ¤ë”':'Esther',
  'ìš¥ê¸°':'Job','ì‹œí¸':'Psalms','ì ì–¸':'Proverbs','ì „ë„ì„œ':'Ecclesiastes',
  'ì•„ê°€':['Song of Songs','Song of Solomon'],
  'ì´ì‚¬ì•¼':'Isaiah','ì˜ˆë ˆë¯¸ì•¼':'Jeremiah','ì˜ˆë ˆë¯¸ì•¼ì• ê°€':'Lamentations','ì—ìŠ¤ê²”':'Ezekiel','ë‹¤ë‹ˆì—˜':'Daniel',
  'í˜¸ì„¸ì•„':'Hosea','ìš”ì—˜':'Joel','ì•„ëª¨ìŠ¤':'Amos','ì˜¤ë°”ëŒœ':'Obadiah','ìš”ë‚˜':'Jonah','ë¯¸ê°€':'Micah',
  'ë‚˜í›”':'Nahum','í•˜ë°•êµ­':'Habakkuk','ìŠ¤ë°”ëƒ':'Zephaniah','í•™ê°œ':'Haggai','ìŠ¤ê°€ë´':'Zechariah','ë§ë¼ê¸°':'Malachi',
  'ë§ˆíƒœë³µìŒ':'Matthew','ë§ˆê°€ë³µìŒ':'Mark','ëˆ„ê°€ë³µìŒ':'Luke','ìš”í•œë³µìŒ':'John','ì‚¬ë„í–‰ì „':'Acts',
  'ë¡œë§ˆì„œ':'Romans','ê³ ë¦°ë„ì „ì„œ':'1 Corinthians','ê³ ë¦°ë„í›„ì„œ':'2 Corinthians','ê°ˆë¼ë””ì•„ì„œ':'Galatians',
  'ì—ë² ì†Œì„œ':'Ephesians','ë¹Œë¦½ë³´ì„œ':'Philippians','ê³¨ë¡œìƒˆì„œ':'Colossians',
  'ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ':'1 Thessalonians','ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ':'2 Thessalonians',
  'ë””ëª¨ë°ì „ì„œ':'1 Timothy','ë””ëª¨ë°í›„ì„œ':'2 Timothy','ë””ë„ì„œ':'Titus','ë¹Œë ˆëª¬ì„œ':'Philemon',
  'íˆë¸Œë¦¬ì„œ':'Hebrews','ì•¼ê³ ë³´ì„œ':'James','ë² ë“œë¡œì „ì„œ':'1 Peter','ë² ë“œë¡œí›„ì„œ':'2 Peter',
  'ìš”í•œì¼ì„œ':'1 John','ìš”í•œì´ì„œ':'2 John','ìš”í•œì‚¼ì„œ':'3 John','ìœ ë‹¤ì„œ':'Jude','ìš”í•œê³„ì‹œë¡':'Revelation'
};

/* ===== ìœ í‹¸ ===== */
function setStatus(msg, cls){ els.status.textContent = msg; els.status.className = 'status ' + (cls||''); }
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)] }
async function fetchJson(url, opt){ const r = await fetch(url, opt); if(!r.ok) throw new Error(`HTTP ${r.status}`); return r.json(); }

/* ===== í•œêµ­ì–´ ë¡œì»¬ì—ì„œ ë¬´ì‘ìœ„ êµ¬ì ˆ ì„ íƒ ===== */
async function getRandomKoFromLocal(){
  const obj = await fetchJson(KOR_JSON_PATH);
  if(!obj?.books?.length) throw new Error('ë¡œì»¬ JSON êµ¬ì¡° ì˜¤ë¥˜(books ì—†ìŒ)');
  // ì±… â†’ ì¥ â†’ ì ˆ ì„ íƒ (ë¹ˆ ì¥/ì ˆ íšŒí”¼)
  for(let tries=0; tries<20; tries++){
    const b = pick(obj.books);
    const chs = Array.isArray(b.chapters) ? b.chapters.filter(c=>Array.isArray(c.verses) && c.verses.length) : [];
    if(!chs.length) continue;
    const c = pick(chs);
    const v = pick(c.verses);
    if(!v || !v.number || !v.text) continue;
    return { bookKo:b.name, chap:c.number, verse:v.number, text:v.text.trim() };
  }
  throw new Error('ìœ íš¨í•œ ì¥/ì ˆì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
}

/* ===== ê°™ì€ êµ¬ì ˆì„ ì˜ì–´ WEBì—ì„œ ê°€ì ¸ì˜¤ê¸° ===== */
async function getEnglishFor(bookKo, chap, verse){
  let names = BOOK_MAP[bookKo];
  if(!names) throw new Error(`ì±…ëª… ë§¤í•‘ ì—†ìŒ: ${bookKo}`);
  if(!Array.isArray(names)) names = [names];
  let lastErr = null;
  for(const bookEn of names){
    try{
      const q = encodeURIComponent(`${bookEn} ${chap}:${verse}`);
      const data = await fetchJson(`${BIBLE_API_BASE}/${q}?translation=web`);
      if(data && data.text && data.reference){
        return { bookEn: bookEn, text: data.text.trim(), refEn: data.reference };
      }
    }catch(e){ lastErr = e; }
  }
  throw lastErr || new Error('ì˜ì–´ êµ¬ì ˆ ìˆ˜ì‹  ì‹¤íŒ¨');
}

/* ===== ë Œë” ===== */
function renderBoth(koRef, koText, enRef, enText){
  els.koRef.textContent = koRef;
  els.koText.textContent = koText;
  els.enRef.textContent = enRef;
  els.enText.textContent = enText;
}

/* ===== ë©”ì¸ ë²„íŠ¼ ===== */
els.btnRandom.addEventListener('click', async ()=>{
  setStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦', '');
  try{
    // 1) í•œêµ­ì–´(ë¡œì»¬)ì—ì„œ ë¬´ì‘ìœ„ êµ¬ì ˆ ì„ íƒ
    const ko = await getRandomKoFromLocal(); // {bookKo, chap, verse, text}
    const koRef = `${ko.bookKo} ${ko.chap}:${ko.verse}`;

    // 2) ë™ì¼ êµ¬ì ˆì„ ì˜ì–´ WEBì—ì„œ ê°€ì ¸ì˜¤ê¸°
    let en;
    try{
      en = await getEnglishFor(ko.bookKo, ko.chap, ko.verse);
    }catch(err){
      // ì˜ì–´ ì‹¤íŒ¨ì‹œ: í•œêµ­ì–´ë§Œ í‘œê¸° + ìƒíƒœ ê²½ê³ 
      renderBoth(koRef, ko.text, '(ì˜ì–´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨)', 'â€”');
      setStatus(`ì˜ì–´ êµ¬ì ˆ ë¡œë”© ì‹¤íŒ¨: ${err?.message||err}`, 'warn');
      return;
    }

    // 3) ë Œë”
    renderBoth(koRef, ko.text, en.refEn, en.text);
    setStatus('ì™„ë£Œ', 'ok');
  }catch(err){
    setStatus('ì˜¤ë¥˜: ' + (err?.message || err), 'err');
  }
});

/* ===== ë³µì‚¬ ===== */
els.btnCopy.addEventListener('click', ()=>{
  const t = `[${els.koRef.textContent}] ${els.koText.textContent}\n[${els.enRef.textContent}] ${els.enText.textContent}`;
  navigator.clipboard.writeText(t).then(()=> setStatus('í´ë¦½ë³´ë“œë¡œ ë³µì‚¬ë¨', 'ok'))
  .catch(e=> setStatus('ë³µì‚¬ ì‹¤íŒ¨: ' + e.message, 'err'));
});
</script>
</body>
</html>
